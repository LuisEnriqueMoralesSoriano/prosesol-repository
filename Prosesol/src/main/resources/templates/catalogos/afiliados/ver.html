<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head"></head>
<meta charset="utf-8" />
<body>
	<div class="page-wrapper">
		<!-- Page Top Bar Area -->
		<div th:replace="fragments/header :: header"></div>
		<div class="layout-container-area mt-70">
			<!-- Side Menu Area -->
			<div th:replace="fragments/sidebar :: sidebar"></div>

			<!-- Layout Container -->
			<div class="layout-container sidemenu-container">

				<div class="container-fluid">
					<div class="row ">

						<div class="col-md mb-4">
							<!-- Card Body -->
							<div class="card-body bg-white appwork bg-boxshadow-2">
								<h5 class="card-title">Afiliados</h5>
								<div class="card-subtitle text-muted mb-3">Lista de
									afiliados activos de la plantilla Prosesol</div>

								<a sec:authorize="hasRole('ROLE_ADMINISTRADOR')"
									th:href="@{/afiliados/crear}"
									class="btn m-2 rounded-0 btn-sm btn-primary"><i
									class="fas fa-user-plus"> </i> Nuevo Afiliado</a>

								<div class="clearfix"></div>
								<hr>

								<div class="row">
									<table id="dataTable"
										class="table table-bordered">
										<thead>
											<tr>
												<th sec:authorize="hasRole('ROLE_ADMINISTRADOR')">Opciones</th>
												<th>Nombre</th>
												<th>Tipo de afiliado</th>
												<th>Estatus</th>
												<th>Estado de afiliación</th>
												<th>Servicio</th>
												<th>Saldo</th>
											</tr>
										</thead>
										<tbody>
											<tr th:switch="${afiliado.estatus}"
												th:each="afiliado : ${afiliados}">

												<td sec:authorize="hasRole('ROLE_ADMINISTRADOR')">
													<div class="dropdown">
														<button class="btn btn-info btn-xs dropdown-toggle"
															type="button" id="dropdownMenuButton"
															data-toggle="dropdown" aria-haspopup="true"
															aria-expanded="false">
															<i class="fas fa-stream"></i>
														</button>
														<div class="dropdown-menu animated--fade-in"
															aria-labelledby="dropdownMenuButton">
															
															<a class="dropdown-item"
																th:href="@{/afiliados/detalle/} + ${afiliado.id}"
																th:text="'Ver'"> </a> 
															
															<a class="dropdown-item"
																th:href="@{/afiliados/editar/} + ${afiliado.id}"
																th:text="'Editar'"> </a> 
															
															<a class="dropdown-item"
																th:href="@{/beneficiarios/crear/} + ${afiliado.id}"
																th:if="${not afiliado.isBeneficiario}">Agregar
																Beneficiario </a> 
																
															<a class="dropdown-item"
																th:href="@{/afiliados/ver/} + ${afiliado.id}"
																th:if="${afiliado.estatus == 3}" th:text="Activar"></a>

															<a class="dropdown-item"
																th:href="@{/afiliados/ver/} + ${afiliado.id}"
																th:if="${afiliado.estatus == 2}" th:text="Activar"></a>

															<a class="dropdown-item border-top text-danger"
																th:href="@{/afiliados/eliminar/} + ${afiliado.id}"
																th:text="'Borrar'"
																onclick="return confirm('¿Estás seguro de que deseas borrar el registro?')"></a>
														</div>
													</div>
													
												</td>

												<td>
													<span th:text="${afiliado.nombre} + ' ' + ${afiliado.apellidoPaterno} + ' ' + ${afiliado.apellidoMaterno}"></span>
													<br>
													Clave: <span class="text-muted pull-righ" th:text="${afiliado.clave}"></span>		
													<br>
													Fecha Afiliación: <span class="text-muted pull-right" th:text="${afiliado.fechaAfiliacion}"></span>
												</td>
												
												<td>
													<span class="badge badge-info" th:unless="${afiliado.isBeneficiario}">Titular</span>
													<span class="badge badge-primary" th:if="${afiliado.isBeneficiario}">Beneficiario</span>
												</td>
												
												<td>
													<span th:case="1" class="badge badge-success" th:text="Activo"></span>
													<span th:case="2" class="badge badge-dark" th:text="Inactivo"></span>
													<span th:case="3" class="badge badge-primary" th:text="Candidato"></span>										
												</td>
												
												<td>
													<span th:text="${not afiliado.isBeneficiario} ? 'Beneficiarios: ' + ${#lists.size(afiliado.beneficiarios)} : 'Titular: ' + ${afiliado.nombre}"></span>
												</td>

												<td>
													Servicio: <span class="pull-right text-muted" th:text="${afiliado.servicio.nombre}"></span>
													<br>
													Corte: <span class="pull-right text-muted" th:text="${afiliado.fechaCorte}"></span>
													<br>
													Periodo: <span class="pull-right text-muted" th:text="${afiliado.periodicidad.nombre}"></span>
												</td>
												
												<td>
													<span th:text="${afiliado.saldoAcumulado}"></span>
													<span th:text="${afiliado.saldoCorte}"></span>
												</td>
																							
											</tr>
										</tbody>
									</table>
									<nav th:replace="fragments/paginator :: paginator"></nav>
								</div>
							</div>
						</div>

					</div>

				</div>


			</div>

		</div>
	</div>
	<footer th:replace="fragments/footer :: footer"></footer>
</body>

</html>